!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@polpware/fe-dependencies"),require("@polpware/fe-utilities")):"function"==typeof define&&define.amd?define("@polpware/fe-behavior",["exports","@polpware/fe-dependencies","@polpware/fe-utilities"],e):e((t.polpware=t.polpware||{},t.polpware["fe-behavior"]={}),t.dependencies,t.feUtilities)}(this,function(t,e,s){"use strict";var n=e.underscore,h=e.statemachine,r=n.indexOf,i=n.without,f="{from}2{to}";function l(t){return t.charAt(0).toUpperCase()+t.slice(1)}function u(n,r){return function(){var t=n[r];if(t)for(var e=0;e<t.length;e++){t[e].apply(null,arguments)}}}function p(t,e,n){var r=s.replace("Transition {name} from {from} to {to} fails.",{name:t,from:e,to:n});console.log(r)}var o=function(){function t(){this._impl=null,this._initState=null,this._errorHandler=null,this._stateConfiguration={},this._transitionConfiguration={},this._handlers={}}return t.prototype.ensureConfigureStage=function(){if(this._impl)throw new Error("State machine has started.")},t.prototype.ensureRunningStage=function(){if(!this._impl)throw new Error("State machine has not yet started.")},t.prototype.addState=function(t,e,n){this.ensureConfigureStage();var r=this._stateConfiguration;if(r[t])throw new Error("Redefined state: "+t);return r[t]={onEnterCallback:e,onLeaveCallback:n},this},t.prototype.setInitState=function(t){if(this.ensureConfigureStage(),this._initState)throw new Error("Redefined init state: "+this._initState);return this._initState=t,this},t.prototype.addTransition=function(t,e,n,r){this.ensureConfigureStage();var i=this._stateConfiguration,o=this._transitionConfiguration;if(!i[t])throw new Error("Undefined source state: "+t);if(!i[e])throw new Error("Undefined target state: "+e);var a=s.replace(f,{from:t,to:e});if(o[a])throw new Error("Redefined transition: "+t+" -> "+e);return o[a]={from:t,to:e,onAfterCallback:n,onBeforeCallback:r},this},t.prototype.start=function(){if(this.ensureConfigureStage(),!this._initState)throw new Error("Init state has not been defined.");var t=this._stateConfiguration,e=this._transitionConfiguration,n=[],r={};for(var i in e)if(e.hasOwnProperty(i)){var o=e[i];n.push({name:i,from:o.from,to:o.to}),o.onAfterCallback&&(r["onAfter"+l(i)]=o.onAfterCallback),o.onBeforeCallback&&(r["onBefore"+l(i)]=o.onAfterCallback)}for(var a in t)if(t.hasOwnProperty(a)){var s=t[a];s.onEnterCallback&&(r["onEnter"+l(a)]=s.onEnterCallback),s.onLeaveCallback&&(r["onLeave"+l(a)]=s.onLeaveCallback)}var f=this._handlers;return f.onEnterState=[],f.onLeaveState=[],r.onEnterState=u(this._handlers,"onEnterState"),r.onLeaveState=u(this._handlers,"onLeaveState"),this._impl=new h({init:this._initState,transitions:n,methods:r,onInvalidTransition:this._errorHandler||p}),this},t.prototype.onEnterState=function(t){var e=this._handlers.onEnterState;if(0<=r(e,t))throw new Error("Re-registering a hander!");return e.push(t),this},t.prototype.onExitState=function(t){var e=this._handlers.onLeaveState;if(0<=r(e,t))throw new Error("Registering a hander!");return e.push(t),this},t.prototype.offEnterState=function(t){var e=this._handlers.onEnterState;return this._handlers.onenterstate=i(e,t),this},t.prototype.offExitState=function(t){var e=this._handlers.onLeaveState;return this._handlers.onexitstate=i(e,t),this},t.prototype.go=function(t){if(this.ensureRunningStage(),!this._stateConfiguration[t])throw new Error("Go to undefined state: "+t);if(this._impl.is(t))return this;var e=this._impl.state,n=s.replace(f,{from:e,to:t});if(this._impl.cannot(n))throw new Error("Transition is not allowed: "+e+" -> "+t);return this._impl[n].call(this._impl),self},t.prototype.addErrorHandler=function(t){return this.ensureConfigureStage(),this._errorHandler=t,this},t.prototype.current=function(){return this.ensureRunningStage(),this._impl.state},t}();t.FiniteStateMachine=o,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=polpware-fe-behavior.umd.min.js.map