{"version":3,"file":"polpware-fe-behavior.umd.js.map","sources":["ng://@polpware/fe-behavior/lib/state/finite-state-machine.ts"],"sourcesContent":["/**\n * @fileOverview\n * Provides a class representing a finite state machine.\n * @author Xiaolong Tang <xxlongtang@gmail.com>\n * @license Copyright @me\n */\nimport * as dependencies from '@polpware/fe-dependencies';\nimport { replace as replaceStr } from '@polpware/fe-utilities';\n\n// A set of helper functions\nconst _ = dependencies.underscore;\nconst StateMachine = dependencies['statemachine'];\nconst indexOf = _.indexOf;\nconst without = _.without;\nconst transitionKeyFormat = '{from}2{to}';\nconst errorMessageFormat = 'Transition {name} from {from} to {to} fails.';\n\n\nfunction captialize(value: string): string {\n    return value.charAt(0).toUpperCase() + value.slice(1);\n}\n\ninterface IUnderlyImpl {\n    state: string;\n    is(stateName: string): boolean;\n    cannot(transitionName: string): boolean;\n    fire(transitionName: string): any;\n}\n\ninterface ILifeCycleEvent {\n    transition: string;\n    from: string;\n    to: string;\n}\n\ntype MethodCallbackType = (ILifeCycleEvent) => void;\ntype ErrorHandlerType = (name: string, from: string, to: string) => void;\n\ninterface IStateSpecification {\n    onEnterCallback?: MethodCallbackType;\n    onLeaveCallback?: MethodCallbackType;\n}\n\ninterface ITransitionSpecification {\n    from: string;\n    to: string;\n    onBeforeCallback?: MethodCallbackType;\n    onAfterCallback?: MethodCallbackType;\n}\n\n/**\n * Builds a handler with necessary context information.\n * The resulting return value is a closure indeed.\n */\nfunction buildHandlerInClosure(context: { [key: string]: Array<MethodCallbackType> }, key: string) {\n    return function() {\n        const ourHandlers = context[key];\n        if (!ourHandlers) {\n            return;\n        }\n        for (let i = 0; i < ourHandlers.length; i++) {\n            const func = ourHandlers[i];\n            func.apply(null, arguments);\n        }\n    };\n}\n\n/**\n * Default error handler for the FSM.\n */\nfunction defaultErrorHandler(eventName: string, from: string, to: string): void {\n    const info = replaceStr(errorMessageFormat, {\n        name: eventName,\n        from: from,\n        to: to\n    });\n    console.log(info);\n}\n\n/**\n * Represents a finite state machine.\n * The resulting FSM is built upon a commonly used javascript\n * state machine library.\n * Such a design (of architecture) is based on the following considerations:\n * - A user-friendly interface for defining states and their behaviors\n * - A kind of model-checking capability for verifying the correctness of\n * transitions\n * - Support for asychronous and synchrous transitions\n * - Support for global exception handling\n * @class FSM\n */\nexport class FiniteStateMachine {\n\n    private _impl: IUnderlyImpl;\n    private _initState: string;\n    private _errorHandler: ErrorHandlerType;\n    private _stateConfiguration: { [key: string]: IStateSpecification };\n    private _transitionConfiguration: { [key: string]: ITransitionSpecification };\n    private _handlers: { [key: string]: Array<MethodCallbackType> };\n\n    constructor() {\n        this._impl = null;\n        this._initState = null;\n        this._errorHandler = null;\n        this._stateConfiguration = {};\n        this._transitionConfiguration = {};\n        this._handlers = {};\n    }\n\n    /**\n     * Checks if FSM is in configuration stage.\n     */\n    private ensureConfigureStage() {\n        if (this._impl) {\n            throw new Error('State machine has started.');\n        }\n    }\n\n    /**\n     * Checks if FSM is in running stage.\n     */\n    private ensureRunningStage() {\n        if (!this._impl) {\n            throw new Error('State machine has not yet started.');\n        }\n    }\n\n    /**\n     * Defines the behavior when the FSM moves into a state by a transition.\n     */\n    addState(name: string,\n        onEnterCallback?: MethodCallbackType,\n        onLeaveCallback?: MethodCallbackType) {\n        // Pre-conditions\n        this.ensureConfigureStage();\n        const stateConf = this._stateConfiguration;\n        if (stateConf[name]) {\n            throw new Error('Redefined state: ' + name);\n        }\n        stateConf[name] = {\n            onEnterCallback: onEnterCallback,\n            onLeaveCallback: onLeaveCallback\n        };\n        return this;\n    }\n\n    /**\n     * Defines the init state for the FSM.\n     */\n    setInitState(name: string) {\n        // Pre-conditions\n        this.ensureConfigureStage();\n\n        if (this._initState) {\n            throw new Error('Redefined init state: ' + this._initState);\n        }\n        this._initState = name;\n        return this;\n    }\n\n    /**\n     * Defines a new stransition.\n     */\n    addTransition(from: string,\n        to: string,\n        onAfterCallback?: MethodCallbackType,\n        onBeforeCallback?: MethodCallbackType) {\n        // Pre-condition\n        this.ensureConfigureStage();\n\n        const stateConf = this._stateConfiguration;\n        const transitionConf = this._transitionConfiguration;\n        if (!stateConf[from]) {\n            throw new Error('Undefined source state: ' + from);\n        }\n        if (!stateConf[to]) {\n            throw new Error('Undefined target state: ' + to);\n        }\n        const key = replaceStr(transitionKeyFormat, { from: from, to: to });\n        if (transitionConf[key]) {\n            throw new Error('Redefined transition: ' + from + ' -> ' + to);\n        }\n        transitionConf[key] = {\n            from: from, to: to,\n            onAfterCallback: onAfterCallback,\n            onBeforeCallback: onBeforeCallback\n        };\n        return this;\n    }\n\n    /**\n     * Starts the FSM. Note that this method must be invoked before\n     * any method which may change the state of the FSM.\n     */\n    start() {\n\n        this.ensureConfigureStage();\n        if (!this._initState) {\n            throw new Error('Init state has not been defined.');\n        }\n\n        // Definition\n        const stateConf: Object = this._stateConfiguration;\n        const transitionConf: Object = this._transitionConfiguration;\n\n        const transitions: Array<{ name: string, from: string, to: string }> = [];\n        const methods: { [key: string]: MethodCallbackType } = {};\n\n        for (const k1 in transitionConf) {\n            if (transitionConf.hasOwnProperty(k1)) {\n                const elem1 = transitionConf[k1];\n                transitions.push({\n                    name: k1,\n                    from: elem1.from,\n                    to: elem1.to\n                });\n\n                if (elem1.onAfterCallback) {\n                    methods['onAfter' + captialize(k1)] = elem1.onAfterCallback;\n                }\n                if (elem1.onBeforeCallback) {\n                    methods['onBefore' + captialize(k1)] = elem1.onAfterCallback;\n                }\n            }\n        }\n\n        for (const k2 in stateConf) {\n\n            if (stateConf.hasOwnProperty(k2)) {\n                const elem2 = stateConf[k2];\n\n                if (elem2.onEnterCallback) {\n                    methods['onEnter' + captialize(k2)] = elem2.onEnterCallback;\n                }\n                if (elem2.onLeaveCallback) {\n                    methods['onLeave' + captialize(k2)] = elem2.onLeaveCallback;\n                }\n            }\n        }\n\n        const handlers = this._handlers;\n        handlers.onEnterState = [];\n        handlers.onLeaveState = [];\n\n        methods['onEnterState'] = buildHandlerInClosure(this._handlers, 'onEnterState');\n        methods['onLeaveState'] = buildHandlerInClosure(this._handlers, 'onLeaveState');\n\n        this._impl = new StateMachine({\n            init: this._initState,\n            transitions: transitions,\n            methods: methods,\n            onInvalidTransition: this._errorHandler || defaultErrorHandler\n        });\n        return this;\n    }\n\n    /**\n     * Registers a handler for enterstate\n     */\n    onEnterState(handler: MethodCallbackType) {\n        const ourHandlers = this._handlers.onEnterState;\n        if (indexOf(ourHandlers, handler) >= 0) {\n            throw new Error('Re-registering a hander!');\n        }\n        ourHandlers.push(handler);\n        return this;\n    }\n\n    /**\n     * Registers a handler for exitstate\n     */\n    onExitState(handler: MethodCallbackType) {\n        const ourHandlers = this._handlers.onLeaveState;\n        if (indexOf(ourHandlers, handler) >= 0) {\n            throw new Error('Registering a hander!');\n        }\n        ourHandlers.push(handler);\n        return this;\n    }\n\n    /**\n     * Un-register a handler for enterstate\n     */\n    offEnterState(handler: MethodCallbackType) {\n        const ourHandlers = this._handlers.onEnterState;\n        this._handlers.onenterstate = without(ourHandlers, handler);\n        return this;\n    }\n\n    /**\n     * Un-register a handler for exitstate\n     */\n    offExitState(handler: MethodCallbackType) {\n        const ourHandlers = this._handlers.onLeaveState;\n        this._handlers.onexitstate = without(ourHandlers, handler);\n        return this;\n    }\n\n    /**\n     * Performs a transition to the given state.\n     * This method also validate the transition.\n     */\n    go(to: string) {\n        this.ensureRunningStage();\n\n        const stateConf = this._stateConfiguration;\n        if (!stateConf[to]) {\n            throw new Error('Go to undefined state: ' + to);\n        }\n        if (this._impl.is(to)) {\n            // TODO: check if the underlying implementation takes into account\n            // moving from one state to itself\n            return this;\n        }\n        const currentState = this._impl.state;\n        const transitionName = replaceStr(transitionKeyFormat, { from: currentState, to: to });\n        // Validate if this transition is allowed or not\n        if (this._impl.cannot(transitionName)) {\n            throw new Error('Transition is not allowed: ' + currentState + ' -> ' + to);\n        }\n\n        // Invoke this function\n        const func = this._impl[transitionName];\n        func.call(this._impl);\n        return self;\n    }\n\n    /**\n     * Provides the error handler for the FSM.\n     */\n    addErrorHandler(fn: ErrorHandlerType) {\n        this.ensureConfigureStage();\n\n        this._errorHandler = fn;\n\n        return this;\n    }\n\n    /**\n     * Returns the current state.\n     */\n    current() {\n        this.ensureRunningStage();\n        return this._impl.state;\n    }\n}\n"],"names":["dependencies.underscore","dependencies['statemachine']","replaceStr"],"mappings":"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"}
